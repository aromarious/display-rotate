#!/bin/sh
usage_message="Usage: display-rotate <display-id>
       display-rotate --version|-v

  <display-id>: ID of the display to rotate
  --version|-v: Show version information

  You can also place ~/.display-rotate with the display id that you want to rotate.
  Execute \"displayplacer list\" command to pick up display id"
script_dir=$(dirname "$(realpath "$0")")
export DISPLAY_ROTATE_ID=$(cat ~/.display-rotate 2>/dev/null)

if ! displayplacer --version >/dev/null 2>&1; then
  if ! brew --version >/dev/null 2>&1; then
    brew install displayplacer
  else
    echo "displayplacer is not installed and brew is not available." >&2
    exit 1
  fi
fi

result=$(displayplacer list | tail -1 | node "${script_dir}/../dist/display-rotate.js" "$@") ||
  {
    echo "$usage_message" >&2
    exit 1
  }
eval $result
